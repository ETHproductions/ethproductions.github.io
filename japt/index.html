<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1"/>
<title>Japt interpreter</title>
<link rel="stylesheet" type="text/css" href="../style/style.css">
<script src="https://rawgit.com/ETHproductions/Japt/master/dependencies/shoco.js"></script>
<script>
  var v="master";
  
  function escapedBtoA(text) {
    return btoa(
      text.replace(/./g,function(x){
        if(x.charCodeAt(0)<256)
          return x;
        return "\\u"+("00"+x.charCodeAt(0).toString(16)).slice(-4)
      })
    );
  }
  
  function escapedAtoB(text) {
    return atob(text).replace(/\\u[0-9A-Fa-f]{4}/g,function(x){return String.fromCharCode(parseInt(x.slice(2),16))});
  }
  
  function splitAddress() {
    var args=location.search.match(/[&?](code|input|v)=([^&]|&(?!(code|input|v)=))*/g);
    var code="[U,V*Wg0 ,Wg1]qS";
    if(args)for(var i of args){
      var tmp=i.slice(i.indexOf('=')+1);
      if(i.slice(1,i.indexOf('='))==="code")
        code=escapedAtoB(tmp);
      else if(i.slice(1,i.indexOf('='))==="input")
        document.getElementById("input").value=escapedAtoB(tmp);
      else
        v=tmp;
    }
    var script = document.createElement('script');
    script.setAttribute("src","https://rawgit.com/ETHproductions/Japt/"+v+"/src/japt-interpreter.js");
    document.getElementsByTagName('head')[0].appendChild(script);
    setTimeout(function(){
    document.getElementById("code").value=code;
    if(typeof transpile!=="undefined")document.getElementById("js-code").value=transpile(code);
    },200);
  }
  
  function getURL() {
    var code = escapedBtoA(document.getElementById("code").value);
    var input = escapedBtoA(document.getElementById("input").value);
    document.getElementById("output").value = "http://ethproductions.github.io/japt?v="+v+"&code="+code+"&input="+input;
  }
</script>
</head>
<body onload="splitAddress()">
<p>&nbsp;</p>
<h1>Japt</h1>
<p>Here lies some meaningless text.</p>
Code:
<br>
<textarea id="code" rows="8" onkeypress="setTimeout(function(){document.getElementById('js-code').value=transpile(document.getElementById('code').value)},10)">[U,V*Wg0 ,Wg1]qS</textarea><textarea id="js-code" rows="8" readonly>[U,V*W.g(0),W.g(1)].q(S)</textarea>
<br>Input:
<br>
<textarea id="input" rows="6">"abc" 13 [9 "zyx"]</textarea><textarea id="output" rows="6"></textarea>
<p>Timeout: (doesn't work)
  <input id="timeout" type="checkbox" checked="checked">&nbsp;
  <br>
  <br>
  <input id="run" type="button" value="Run" onclick="run()">
  <input id="stop" type="button" value="Stop" onclick="interrupt()" disabled="disabled">
  <input id="clear" type="button" value="Clear" onclick="clear_output()">
  <br>
  <input id="permalink" type="button" value="Permalink" onclick="getURL()">
  <br>
  <span id="stderr" style="color:red"></span>
</p>
</body>
</html>
